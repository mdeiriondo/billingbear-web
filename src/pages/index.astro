---
import Layout from '../layouts/Layout.astro';
import { getVouchers, getCourseStatus } from '../lib/wp';

// Fetch de datos en tiempo de compilación (SSG)
const vouchers = await getVouchers();
const courseStatus = await getCourseStatus();

// Formateador de imagen de WordPress
const getImageUrl = (v: any) => v._embedded?.['wp:featuredmedia']?.[0]?.source_url || 'https://images.unsplash.com/photo-1535131749006-b7f58c99034b?auto=format&fit=crop&q=80';

// Ayudante para limpiar el status del curso
const displayStatus = courseStatus ? courseStatus.replace('_', ' ') : 'Open';
---

<Layout title="Billingbear Park | Golf in the Royal Landscape">
	
	<!-- 1. TOP BAR: COURSE STATUS -->
	<div class="bg-brand-green text-white text-[10px] md:text-xs py-2 px-6 flex justify-between items-center tracking-widest uppercase border-b border-white/10 relative z-50">
		<div class="flex gap-6 font-medium">
			<span class="flex items-center gap-2">
				<span class={`w-2 h-2 rounded-full ${courseStatus === 'open' ? 'bg-green-400 animate-pulse' : 'bg-yellow-400'}`}></span> 
				Course Status: <span class="text-brand-gold">{displayStatus}</span>
			</span>
		</div>
		<div class="hidden md:block opacity-70 font-serif italic lowercase tracking-normal text-sm">
			berkshire heritage golf
		</div>
	</div>

	<!-- 2. NAVIGATION -->
	<nav class="absolute w-full z-40 px-6 py-6 border-b border-white/10 mt-0 md:mt-2">
		<div class="max-w-7xl mx-auto flex justify-between items-center">
			<div class="text-white font-serif text-2xl font-semibold tracking-tight">
				Billingbear Park
			</div>
			
			<div class="hidden md:flex gap-8 text-white/90 text-sm font-medium tracking-wide">
				<a href="#old-course" class="hover:text-brand-gold transition-colors">The Old Course</a>
				<a href="#new-course" class="hover:text-brand-gold transition-colors">The New Course</a>
				<a href="#heritage" class="hover:text-brand-gold transition-colors">Heritage</a>
				<a href="#weddings" class="hover:text-brand-gold transition-colors">Weddings</a>
			</div>

			<a href="https://visitors.brsgolf.com/billingbearpark" class="bg-white text-brand-green px-5 py-2 rounded-sm text-xs font-bold uppercase tracking-widest hover:bg-brand-gold transition-colors">
				Book Tee Time
			</a>
		</div>
	</nav>

	<main>
		<!-- 3. HERO SECTION -->
		<header class="relative h-[90vh] w-full overflow-hidden flex items-end pb-24">
			<img 
				src="https://images.unsplash.com/photo-1587174486073-ae5e5cff23aa?q=80&w=2070&auto=format&fit=crop" 
				class="absolute inset-0 w-full h-full object-cover"
				alt="Billingbear Golf Course Drone View"
			/>
			<div class="absolute inset-0 bg-black/30"></div>
			<div class="absolute inset-0 hero-overlay"></div>

			<div class="relative z-10 max-w-7xl mx-auto px-6 w-full flex flex-col md:flex-row items-end justify-between gap-10">
				<div class="max-w-2xl">
					<span class="text-brand-gold uppercase tracking-[0.2em] text-xs font-bold mb-4 block">
						Est. 1989 • Designed by Martin Hawtree
					</span>
					<h1 class="text-5xl md:text-8xl text-white font-serif font-medium leading-[1] mb-6">
						Golf in the Royal<br>Landscape.
					</h1>
					<p class="text-white/80 text-lg font-light max-w-lg leading-relaxed">
						Walk the fairways of history. A pure golfing experience built on the ancient grounds of the Tudor Dynasty.
					</p>
				</div>

				<div class="flex flex-col gap-3 w-full md:w-auto">
					<a href="https://visitors.brsgolf.com/billingbearpark" class="bg-brand-gold text-brand-green w-full md:w-64 py-4 px-6 text-sm font-bold uppercase tracking-widest hover:bg-white transition-colors text-center block">
						Book Tee Time
					</a>
					<a href="#vouchers" class="border border-white/30 backdrop-blur-sm text-white w-full md:w-64 py-4 px-6 text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-brand-green transition-colors text-center block">
						Gift Experiences
					</a>
				</div>
			</div>
		</header>

		<!-- 4. INTRO SECTION -->
		<section class="py-32 px-6 bg-brand-cream">
			<div class="max-w-4xl mx-auto text-center">
				<h2 class="font-serif text-4xl md:text-5xl text-brand-green mb-8 italic">
					"A seamless blend of history and sport."
				</h2>
				<div class="w-24 h-px bg-brand-gold mx-auto mb-10"></div>
				<p class="text-brand-dark/70 leading-relaxed text-xl font-light">
					Billingbear Park offers two distinct courses set within 120 acres of mature parkland. 
					Whether you challenge the strategic <strong class="text-brand-green font-medium">Old Course</strong> or enjoy a relaxed round on the <strong class="text-brand-green font-medium">New Course</strong>, 
					you are playing on land that once served King Henry VIII.
				</p>
			</div>
		</section>

		<!-- 5. DYNAMIC VOUCHERS SECTION (BENTO GRID) -->
		<section id="vouchers" class="py-24 px-6 bg-white border-y border-brand-stone">
			<div class="max-w-7xl mx-auto">
				<div class="flex justify-between items-end mb-16">
					<div>
						<span class="text-brand-gold uppercase tracking-widest text-xs font-bold">The Pro Shop</span>
						<h3 class="font-serif text-4xl text-brand-green mt-2">Gift Experiences</h3>
					</div>
					<div class="hidden md:block">
						<p class="text-brand-dark/50 italic text-sm font-serif">Perfect for every occasion</p>
					</div>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
					{vouchers.map((voucher: any) => {
						const isFeatured = voucher.acf?.is_featured;
						const price = voucher.acf?.price;
						const cta = voucher.acf?.cta_link || '#';
						
						return (
							<div class={`group relative overflow-hidden cursor-pointer rounded-sm shadow-sm hover:shadow-xl transition-all duration-500 ${isFeatured ? 'md:col-span-2 h-[500px]' : 'h-[500px] bg-brand-cream border border-brand-stone'}`}>
								
								<img src={getImageUrl(voucher)} class="absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110" alt={voucher.title.rendered} />
								
								{/* Overlay para legibilidad */}
								<div class={`absolute inset-0 ${isFeatured ? 'bg-brand-green/40 group-hover:bg-brand-green/60' : 'bg-black/20 group-hover:bg-black/40'} transition-colors duration-500`}></div>

								<div class="absolute inset-0 p-10 flex flex-col justify-between z-10">
									<div class="flex justify-between items-start">
										{isFeatured ? (
											<span class="bg-white text-brand-green text-[10px] font-bold px-3 py-1 uppercase tracking-widest w-fit">Featured Experience</span>
										) : (
											<span class="bg-brand-green text-white text-[10px] font-bold px-3 py-1 uppercase tracking-widest w-fit">Voucher</span>
										)}
									</div>
									
									<div class="text-white">
										<h4 class="font-serif text-4xl mb-3 leading-tight" set:html={voucher.title.rendered}></h4>
										<div class="text-base opacity-90 mb-6 font-light line-clamp-3" set:html={voucher.content.rendered}></div>
										
										<div class="flex items-center gap-6">
											<span class="text-brand-gold text-3xl font-serif italic">{price}</span>
											<a href={cta} class="bg-white/10 backdrop-blur-md border border-white/30 text-white px-6 py-2 text-xs uppercase tracking-widest font-bold hover:bg-white hover:text-brand-green transition-all">
												Purchase &rarr;
											</a>
										</div>
									</div>
								</div>
							</div>
						);
					})}
				</div>
			</div>
		</section>
	</main>

	<!-- 6. FOOTER -->
	<footer class="bg-brand-green text-brand-cream py-20 px-6">
		<div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-16">
			<div>
				<div class="font-serif text-3xl mb-8">Billingbear Park</div>
				<p class="text-white/60 text-sm leading-relaxed max-w-xs">
					Historic golf in the heart of Berkshire. A Martin Hawtree design built on Tudor grounds.
				</p>
			</div>
			<div class="grid grid-cols-2 gap-8 col-span-2">
				<div class="space-y-4">
					<h5 class="text-brand-gold uppercase tracking-widest text-xs font-bold mb-6">Explore</h5>
					<ul class="space-y-3 text-sm text-white/70">
						<li><a href="#" class="hover:text-white transition-colors">The Old Course</a></li>
						<li><a href="#" class="hover:text-white transition-colors">The New Course</a></li>
						<li><a href="#" class="hover:text-white transition-colors">Heritage</a></li>
					</ul>
				</div>
				<div class="space-y-4">
					<h5 class="text-brand-gold uppercase tracking-widest text-xs font-bold mb-6">Contact</h5>
					<ul class="space-y-3 text-sm text-white/70 italic">
						<li>The Straight Mile, Wokingham</li>
						<li>Berkshire, RG40 5SJ</li>
						<li class="not-italic text-white pt-2 font-bold underline">+44 (0) 1344 860 860</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>
</Layout>