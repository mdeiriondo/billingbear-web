---
import Layout from '../layouts/Layout.astro';
import { getVouchers } from '../lib/wp';

const vouchers = await getVouchers();

const getImageUrl = (v: any) => v._embedded?.['wp:featuredmedia']?.[0]?.source_url || 'https://images.pexels.com/photos/274133/pexels-photo-274133.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1';

// Categorías para organizar los 11 vouchers
const lessons = vouchers.filter((v: any) => v.title.rendered.toLowerCase().includes('lesson'));
const golf = vouchers.filter((v: any) => !v.title.rendered.toLowerCase().includes('lesson') && !v.title.rendered.toLowerCase().includes('wine'));
const dining = vouchers.filter((v: any) => v.title.rendered.toLowerCase().includes('wine') || v.title.rendered.toLowerCase().includes('refreshments'));
---

<Layout title="Gift Vouchers | Billingbear Park">
    
    <!-- Header Minimalista -->
    <nav class="bg-brand-green text-white py-6 px-6 border-b border-white/10 flex justify-between items-center sticky top-0 z-[100]">
        <a href="/" class="font-serif text-2xl italic tracking-tight">Billingbear <span class="font-sans not-italic font-light text-xs uppercase tracking-widest opacity-50 ml-2">Shop</span></a>
        <a href="/" class="text-[10px] uppercase font-bold tracking-widest border border-white/20 px-4 py-2 hover:bg-brand-gold hover:text-brand-green transition-all leading-none">Back to Site</a>
    </nav>

    <main class="bg-brand-cream min-h-screen">
        <!-- Intro -->
        <header class="py-20 px-6 text-center max-w-3xl mx-auto">
            <span class="text-brand-gold uppercase tracking-[0.3em] text-xs font-bold mb-4 block">Heritage Experiences</span>
            <h1 class="text-5xl md:text-7xl text-brand-green font-serif italic mb-6">Gift Vouchers</h1>
            <p class="text-brand-dark/70 font-light text-lg leading-relaxed">Discover the perfect gift for any golfer. Our vouchers are delivered instantly via email and can be redeemed at our clubhouse.</p>
        </header>

        <!-- Filtros Rápidos -->
        <section class="max-w-7xl mx-auto px-6 mb-12 flex flex-wrap gap-4 justify-center">
            {['All Experiences', 'Green Fees', 'Coaching', 'Food & Drink'].map((cat) => (
                <button class="px-6 py-2 border border-brand-stone text-[10px] uppercase font-bold tracking-widest hover:border-brand-gold hover:text-brand-gold transition-all bg-white rounded-full leading-none">{cat}</button>
            ))}
        </section>

        <!-- Grid de Vouchers (3 Columnas Uniforme para Catálogo) -->
        <section class="max-w-7xl mx-auto px-6 pb-24">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {vouchers.map((voucher: any) => {
                    const price = voucher.acf?.price;
                    const wooId = voucher.acf?.woo_product_id;
                    const cta = voucher.acf?.cta_link || (wooId ? `https://billingbearpark.com/checkout/?add-to-cart=${wooId}` : '#');
                    
                    return (
                        <div id={voucher.id} class="bg-white border border-brand-stone rounded-sm overflow-hidden flex flex-col hover:shadow-2xl transition-all duration-500 group">
                            <div class="aspect-[4/3] overflow-hidden relative">
                                <img src={getImageUrl(voucher)} class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 group-hover:scale-105" />
                                <div class="absolute top-4 right-4 bg-brand-green text-white px-3 py-1 text-[10px] font-bold uppercase tracking-widest leading-none">Gift Option</div>
                            </div>
                            <div class="p-8 flex flex-col flex-grow">
                                <h3 class="font-serif text-2xl text-brand-green mb-3 italic" set:html={voucher.title.rendered}></h3>
                                <div class="text-sm text-brand-dark/60 font-light leading-relaxed mb-6 flex-grow" set:html={voucher.content.rendered}></div>
                                
                                <div class="flex items-center justify-between pt-6 border-t border-brand-stone mt-auto">
                                    <span class="text-brand-green font-serif text-2xl italic leading-none">{price}</span>
                                    <a href={cta} target="_blank" class="bg-brand-green text-white px-6 py-3 text-[10px] font-bold uppercase tracking-widest hover:bg-brand-gold transition-all leading-none shadow-md">Purchase Now</a>
                                </div>
                            </div>
                        </div>
                    );
                })}
            </div>
        </section>

        <!-- Info de Canje -->
        <section class="bg-brand-green text-brand-cream py-16 px-6 text-center">
            <div class="max-w-2xl mx-auto">
                <h4 class="font-serif text-3xl italic mb-4 text-brand-gold">How it works</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-12 text-white/70">
                    <div>
                        <div class="text-brand-gold font-serif text-3xl mb-4 italic">01</div>
                        <p class="text-xs font-bold uppercase tracking-widest mb-2 text-white">Choose & Buy</p>
                        <p class="text-xs font-light">Select your experience and checkout securely.</p>
                    </div>
                    <div>
                        <div class="text-brand-gold font-serif text-3xl mb-4 italic">02</div>
                        <p class="text-xs font-bold uppercase tracking-widest mb-2 text-white">Receive Email</p>
                        <p class="text-xs font-light">Your digital voucher arrives instantly in your inbox.</p>
                    </div>
                    <div>
                        <div class="text-brand-gold font-serif text-3xl mb-4 italic">03</div>
                        <p class="text-xs font-bold uppercase tracking-widest mb-2 text-white">Redeem</p>
                        <p class="text-xs font-light">Bring your code to the clubhouse to enjoy!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-brand-dark py-12 px-6 text-center border-t border-white/5">
        <p class="text-[10px] uppercase tracking-[0.3em] text-white/20">© {new Date().getFullYear()} Billingbear Park Golf Shop</p>
    </footer>
</Layout>